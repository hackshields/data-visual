!function(t,r){var l=t.codiad;r(window).load(function(){l.finder.init()}),l.finder={_makeDomNode:function(t,e){var i,n;for(key in i='<li><span class="none"></span><a',"directory"===e.type?i+=" class='directory open'":(s=t.split("."),i+=" class='file",0<s.length&&(i+=" ext-"+s[s.length-1]),i+="'"),i+=" data-path='"+e.path+"' data-type='"+e.type+"' >"+t+"</a>",n="",e.children)n+=this._makeDomNode(key,e.children[key]);return 0<n.length&&(i+="<ul>"+n+"</ul>"),i+="</li>"},_makeDomTree:function(t){var e="<ul>";for(key in t)e+=this._makeDomNode(key,t[key]);return e+="</ul>"},_makeHierarchy:function(t){t=t.index;var e,i,n,r,a,s,o={};for(i=0;i<t.length;i++)for(a=o,e=l.project.isAbsPath(t[i].path)?t[i].path.replace(this._rootPath,this._rootName).split("/"):t[i].path.split("/"),n=0;n<e.length;n++)""!==(r=e[n])&&(a[r]||(s=n<e.length-1?"directory":t[i].type,a[r]={type:s,children:{}},"file"===s?a[r].path=t[i].path:l.project.isAbsPath(t[i].path)?a[r].path=e.slice(0,n+1).join("/").replace(this._rootName,this._rootPath):a[r].path=e.slice(0,n+1).join("/")),a=a[r].children);return o},_filterTree:function(t){var e=this._makeHierarchy(t),i=this._makeDomTree(e);r("#file-manager").html(i),r("#file-manager>ul>li:first-child>span").remove(),r("#file-manager>ul>li:first-child>a").attr({id:"project-root","data-type":"root","data-path":this._rootPath})},_clearFilters:function(){this._htmlStash&&r("#file-manager").html(this._htmlStash),this._htmlStash=null,r("#finder").attr("value","")},_emptyTree:function(){r("#file-manager").html("No files found .")},_checkFinder:function(){var t=r("#finder").attr("value"),e=this;(t=t.replace(/^\s+|\s+$/g,""))&&t!=this._lastEntry&&(this._xhr&&this._xhr.abort(),this._lastEntry=t,this._xhr=r.ajax({url:"components/filemanager/controller.php",type:"GET",dataType:"json",data:{query:t,action:"find",path:this._rootPath,options:this._options},success:function(t){"success"==t.status?e._filterTree(t.data):e._emptyTree()}}))},expandFinder:function(){this._isFinderExpanded=!0,this._htmlStash=r("#file-manager").html(),this._rootPath=r("#project-root").attr("data-path"),this._rootName=r("#project-root").html(),r("#finder-wrapper").show(),r("#sb-left-title h2").hide();var t=this;this._lastEntry=null,this._poller=setInterval(function(){t._checkFinder()},500),r("#finder").focus(),r("#finder-quick").hide(),r("#sb-left-title").addClass("active"),r("#tree-search").removeClass("icon-search").addClass("icon-cancel-squared active")},contractFinder:function(){this._isFinderExpanded=!1,r("#finder-wrapper").hide("fast"),r("#sb-left-title h2").show("fast"),clearInterval(this._poller),this.finderMenu.hide(),this._clearFilters(),r("#finder-quick").show(),r("#sb-left-title").removeClass("active"),r("#tree-search").removeClass("icon-cancel-squared active").addClass("icon-search")},init:function(){var n=this;this._options={},r("#tree-search").click(function(){n._isFinderExpanded?n.contractFinder():n.expandFinder()}),r("#finder-label").click(function(){n.expandFinder()}),this.finderMenu=finderMenu=r("#finder-options-menu").appendTo(r("#sb-left")).hide(),$finderOptionsMenu=r("#finder-options-menu"),r("#finder-options").click(function(){finderMenu.toggle()}),$finderOptionsMenu.bind("click","a",function(t){$target=r(t.target);var e=$target.attr("data-option"),i=$target.attr("data-action");e?(n._options.strategy=e,$finderOptionsMenu.find("li.chosen").removeClass("chosen"),$target.parent("li").addClass("chosen")):i&&(l.filemanager[i](l.project.getCurrent()),n.contractFinder()),$finderOptionsMenu.hide()}),r("#finder-quick").click(function(t){l.filemanager.search(l.project.getCurrent()),n.contractFinder()})}}}(this,jQuery);