!function(e,u){ace.require("ace/lib/event_emitter").EventEmitter;var c=ace.require("ace/range").Range,i=e.codiad;u(function(){i.autocomplete.init()}),i.autocomplete={wordRegex:/[^a-zA-Z_0-9\$]+/,isVisible:!1,standardGoLineDownExec:null,standardGoLineUpExec:null,_suggestionCache:null,standardGoToRightExec:null,standardGoToLeftExec:null,standardIndentExec:null,init:function(){var e=this;this.$onDocumentChange=this.onDocumentChange.bind(this),this.$selectNextSuggestion=this.selectNextSuggestion.bind(this),this.$selectPreviousSuggestion=this.selectPreviousSuggestion.bind(this),this.$complete=this.complete.bind(this),this.$hide=this.hide.bind(this),u("#autocomplete li").live("click",function(){u("#autocomplete li.active-suggestion").removeClass("active-suggestion"),u(this).addClass("active-suggestion"),e.complete()})},suggest:function(){var e=this,t=this._getEditor().getCursorPosition();if(this.updateSuggestions(t)){this.addListenerToOnDocumentChange(),this.show();var i=function(){e.hide(),u(window).off("click",i)};u(window).on("click",i)}else this.clearSuggestionCache()},updateSuggestions:function(e){var s=this,t=this._getEditSession().getTokenAt(e.row,e.column);if(!t)return this.removeSuggestions(),!1;var n=t.value.substr(0,e.column-t.start);if(""===(n=n.split(this.wordRegex).slice(-1)[0]))return this.removeSuggestions(),!1;var i=this.getSuggestions(e),o=this.rankSuggestions(n,i);if(o.length<1)return this.removeSuggestions(),!1;this.removeSuggestions();var a=u("#autocomplete #suggestions");return u.each(o,function(e,i){i=i.slice(0,-1);var t=s.getMatchIndexes(n,i);u.each(t.reverse(),function(e,t){i=i.substr(0,t)+'<span class="matched">'+i.substr(t,1)+"</span>"+i.substr(t+1)}),a.append('<li class="suggestion">'+i+"</li>")}),this.selectFirstSuggestion(),!0},show:function(){this.isVisible=!0;var e=u("#autocomplete");e.css({top:this._computeTopOffset(),left:this._computeLeftOffset(),"font-family":u(".ace_editor").css("font-family"),"font-size":u(".ace_editor").css("font-size")}),e.slideToggle("fast",function(){u(this).css("overflow","")}),this.addKeyboardCommands()},hide:function(){this.isVisible=!1,u("#autocomplete").hide(),this.removeSuggestions(),this.clearSuggestionCache(),this.removeListenerToOnDocumentChange(),this.removeKeyboardCommands()},getSelectedSuggestion:function(){var e=u("#autocomplete li.suggestion.active-suggestion");return e.length<1?alert(i18n("No suggestion selected. Might be a bug.")):1<e.length&&alert(i18n("More than one suggestions selected. Might be a bug.")),e},selectFirstSuggestion:function(){var e=u("li.suggestion:first-child");e.addClass("active-suggestion"),this._ensureVisible(e,u("#autocomplete"))},selectLastSuggestion:function(){var e=u("li.suggestion:last-child");e.addClass("active-suggestion"),this._ensureVisible(e,u("#autocomplete"))},selectNextSuggestion:function(){var e=this.getSelectedSuggestion();e.removeClass("active-suggestion");var t=e.next();0<t.length?(t.addClass("active-suggestion"),this._ensureVisible(t,u("#autocomplete"))):this.selectFirstSuggestion()},selectPreviousSuggestion:function(){var e=this.getSelectedSuggestion();e.removeClass("active-suggestion");var t=e.prev();0<t.length?(t.addClass("active-suggestion"),this._ensureVisible(t,u("#autocomplete"))):this.selectLastSuggestion()},addListenerToOnDocumentChange:function(){this._getEditSession().addEventListener("change",this.$onDocumentChange)},removeListenerToOnDocumentChange:function(){this._getEditSession().removeEventListener("change",this.$onDocumentChange)},onDocumentChange:function(e){if(-1===e.data.text.search(/^\s+$/)){var t=null;"insertText"===e.data.action?t=e.data.range.end:"removeText"===e.data.action?t=e.data.range.start:alert("Unkown document change action."),this.updateSuggestions(t)||this.hide()}else this.hide()},addKeyboardCommands:function(){var e=this,t=this._getEditor().commands;this.standardGoLineDownExec=t.commands.golinedown.exec,this.standardGoLineUpExec=t.commands.golineup.exec,this.standardGoToRightExec=t.commands.gotoright.exec,this.standardGoToLeftExec=t.commands.gotoleft.exec,this.standardIndentExec=t.commands.indent.exec,t.commands.golinedown.exec=this.$selectNextSuggestion,t.commands.golineup.exec=this.$selectPreviousSuggestion,t.commands.gotoright.exec=this.$complete,t.commands.gotoleft.exec=this.$hide,t.commands.indent.exec=this.$complete,t.addCommand({name:"hideautocomplete",bindKey:"Esc",exec:function(){e.hide()}}),t.addCommand({name:"autocomplete",bindKey:"Return",exec:this.$complete})},removeKeyboardCommands:function(){var e=this._getEditor().commands;null!==this.standardGoLineDownExec&&(e.commands.golinedown.exec=this.standardGoLineDownExec),null!==this.standardGoLineUpExec&&(e.commands.golineup.exec=this.standardGoLineUpExec),null!==this.standardGoToRightExec&&(e.commands.gotoright.exec=this.standardGoToRightExec),null!==this.standardGoToLeftExec&&(e.commands.gotoleft.exec=this.standardGoToLeftExec),null!==this.standardIndentExec&&(e.commands.indent.exec=this.standardIndentExec),e.removeCommand("hideautocomplete"),e.removeCommand("autocomplete")},complete:function(e){var t=this._getEditor(),i=this._getEditSession(),s=(e=t.getCursorPosition(),i.getTokenAt(e.row,e.column));s||(this.clearSuggestionCache(),this.hide(),t.focus());var n=s.value.substr(0,e.column-s.start).split(this.wordRegex).slice(-1)[0].length,o=new c(e.row,e.column-n,e.row,e.column),a=this.getSelectedSuggestion().text();i.replace(o,a),this.hide(),t.focus()},removeSuggestions:function(){u(".suggestion").remove()},getSuggestions:function(e){if(this._suggestionCache)return this._suggestionCache;var t=this._getDocument(),i="__autocomplete_marker__",s=t.getLines(0,e.row-1).join("\n")+"\n",n=t.getLine(e.row);s+=n.substr(0,e.column),s+=i,e.column===n.length&&(s+="\n"),s+=n.substr(e.column+1);var o=(s+=t.getLines(e.row+1,t.getLength()).join("\n")+"\n").split(this.wordRegex),a=0,c="";u.each(o,function(e,t){if(-1!==t.search(i))return a=e,c=t,!1});var r={};return u.each(o,function(e,t){var i=Math.abs(e-a);(!r[t+"-"]||i<r[t])&&(r[t+"-"]=i)}),delete r[c+"-"],this._suggestionCache=r},clearSuggestionCache:function(){this._suggestionCache=null},rankSuggestions:function(e,t){var i=1,s={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=this.computeSimpleMatchScore(e,n);i<o&&(i=o),s[n]=o}for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(this.isMatchingFuzzily(e,n)||delete s[n]);var a={};for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(a[n]=s[n]/n.length);var c=[];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&c.push(n);return c.sort(function(e,t){return a[t]-a[e]}),c},computeSimpleMatchScore:function(e,t){var i=this._isLowerCase(e)?t.toLowerCase():t;if(i.length<e.length)return 0;if(i===e)return e.length;for(var s=0,n=0;n<e.length&&i[n]===e[n];++n)++s;return s},isMatchingFuzzily:function(e,t){for(var i=this._isLowerCase(e)?t.toLowerCase():t,s=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),n="^.*?",o=0;o<s.length;++o)"\\"===s[o]&&(n+=s[o],++o),n+=s[o],n+=".*?";return-1!==i.search(n)},getMatchIndexes:function(e,t){for(var i=this._isLowerCase(e)?t.toLowerCase():t,s=[],n=0,o=0;o<e.length;++o){var a=i.indexOf(e[o],n);s.push(a),n=a+1}return s},_isLowerCase:function(e){return e.toLowerCase()===e},_ensureVisible:function(e,t){var i=t.scrollTop(),s=i+t.innerHeight(),n=e.position().top+i-1,o=n+e.outerHeight()+2;s<o?t.stop().animate({scrollTop:o-t.innerHeight()},100):n<i&&t.stop().animate({scrollTop:n},100)},_computeTopOffset:function(){var e=u(".ace_cursor");if(0<e.length){var t=i.editor.getActive().container.style.fontSize.replace("px","");return(e=u(e[0])).offset().top+1.7*t}},_computeLeftOffset:function(){var e=u(".ace_cursor");if(0<e.length)return(e=u(e[0])).offset().left},_getEditor:function(){return i.editor.getActive()},_getEditSession:function(){return i.editor.getActive().getSession()},_getDocument:function(){return i.editor.getActive().getSession().getDocument()},_testSimpleMatchScorer:function(){var e="myprefix",t="myprefixisshort",i=this.computeSimpleMatchScore(e,t);8!==i&&alert("_testSimpleMatchScorer lowercase test failed."),e="MYPREFIX",t="MYPREFIXISSHORT",8!==(i=this.computeSimpleMatchScore(e,t))&&alert("_testSimpleMatchScorer uppercase test failed."),e="myPrefix",t="myprefixisshort",2!==(i=this.computeSimpleMatchScore(e,t))&&alert("_testSimpleMatchScorer mixed case vs. lowercase test failed."),e="myPrefixIs",t="myPrefixIsShort",10!==(i=this.computeSimpleMatchScore(e,t))&&alert("_testSimpleMatchScorer mixed case test failed.")},_testFuzzyMatcher:function(){var e=this.isMatchingFuzzily("mlf","mylongfunctionname");e||alert("_testFuzzyMatcher mlf vs. mylongfunctionname failed."),(e=this.isMatchingFuzzily("mLn","myLongFunctionName"))||alert("_testFuzzyMatcher mLn vs. myLongFunctionName failed."),(e=this.isMatchingFuzzily("mLFuny","myLongFunctionName"))&&alert("_testFuzzyMatcher mLFuny. myLongFunctionName failed.")}}}(this,jQuery);