!function(e,s){var i=e.codiad;s(function(){i.user.init()}),i.user={loginForm:s("#login"),controller:"components/user/controller.php",dialog:"components/user/dialog.php",init:function(){var t=this;this.loginForm.on("submit",function(e){e.preventDefault(),localStorage.setItem("codiad.language",s("#language").val()),localStorage.setItem("codiad.theme",s("#theme").val()),t.authenticate()});var e=localStorage.getItem("codiad.theme");s("#theme option").each(function(){s(this).val()==e&&s(this).attr("selected","selected")});var o=localStorage.getItem("codiad.language");s("#language option").each(function(){s(this).val()==o&&s(this).attr("selected","selected")}),s(".show-language-selector").click(function(){s(this).hide(),s(".language-selector").animate({height:"toggle"},"fast")})},authenticate:function(){s.post(this.controller+"?action=authenticate",this.loginForm.serialize(),function(e){parsed=i.jsend.parse(e),"error"!=parsed&&window.location.reload()})},logout:function(){var e=!0;0<s("#list-active-files li.changed").length&&(e=confirm(i18n("You have unsaved files."))),e&&(s("#list-active-files li.changed").each(function(){s(this).removeClass("changed")}),amplify.publish("user.logout",{}),i.settings.save(),s.get(this.controller+"?action=logout",function(){window.location.reload()}))},list:function(){s("#modal-content form").die("submit"),i.modal.load(400,this.dialog+"?action=list")},createNew:function(){var a=this;i.modal.load(400,this.dialog+"?action=create"),s("#modal-content form").live("submit",function(e){e.preventDefault();var t=!0,o=s('#modal-content form input[name="username"]').val(),n=s('#modal-content form input[name="password1"]').val();n!=s('#modal-content form input[name="password2"]').val()&&(i.message.error(i18n("Passwords Do Not Match")),t=!1),/^[a-z0-9]+$/i.test(o)&&0!==o.length||(i.message.error(i18n("Username Must Be Alphanumeric String")),t=!1),t&&s.post(a.controller+"?action=create",{username:o,password:n},function(e){"error"!=i.jsend.parse(e)&&(i.message.success(i18n("User Account Created")),a.list())})})},delete:function(e){var o=this;i.modal.load(400,this.dialog+"?action=delete&username="+e),s("#modal-content form").live("submit",function(e){e.preventDefault();var t=s('#modal-content form input[name="username"]').val();s.get(o.controller+"?action=delete&username="+t,function(e){"error"!=i.jsend.parse(e)&&(i.message.success(i18n("Account Deleted")),o.list())})})},projects:function(e){i.modal.load(400,this.dialog+"?action=projects&username="+e);var a=this;s("#modal-content form").live("submit",function(e){e.preventDefault();var t=s('#modal-content form input[name="username"]').val(),o=s('#modal-content form select[name="access_level"]').val(),n=new Array;s('input:checkbox[name="project"]:checked').each(function(){n.push(s(this).val())}),0==o&&(n=0),1!=o||n?s.post(a.controller+"?action=project_access&username="+t,{projects:n},function(e){"error"!=i.jsend.parse(e)&&i.message.success(i18n("Account Modified"))}):i.message.error(i18n("At Least One Project Must Be Selected"))})},password:function(e){var n=this;i.modal.load(400,this.dialog+"?action=password&username="+e),s("#modal-content form").live("submit",function(e){e.preventDefault();var t=s('#modal-content form input[name="username"]').val(),o=s('#modal-content form input[name="password1"]').val();o!=s('#modal-content form input[name="password2"]').val()?i.message.error(i18n("Passwords Do Not Match")):s.post(n.controller+"?action=password",{username:t,password:o},function(e){"error"!=i.jsend.parse(e)&&(i.message.success(i18n("Password Changed")),i.modal.unload())})})},project:function(e){s.get(this.controller+"?action=project&project="+e)}}}(this,jQuery);