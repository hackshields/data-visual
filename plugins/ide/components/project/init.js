!function(e,i){var l=e.codiad;i(function(){l.project.init()}),l.project={controller:"components/project/controller.php",dialog:"components/project/dialog.php",init:function(){this.loadCurrent(),this.loadSide();var e=this;i("#projects-create").click(function(){l.project.create("true")}),i("#projects-manage").click(function(){l.project.list()}),i("#projects-collapse").click(function(){e._sideExpanded?e.projectsCollapse():e.projectsExpand()})},loadCurrent:function(){i.get(this.controller+"?action=get_current",function(e){var t=l.jsend.parse(e);"error"!=t&&(i("#file-manager").html("").append('<ul><li><a id="project-root" data-type="root" class="directory" data-path="'+t.path+'">'+t.name+"</a></li></ul>"),l.filemanager.index(t.path),l.user.project(t.path),l.message.success(i18n("Project %{projectName}% Loaded",{projectName:t.name})))})},open:function(t){var o=this;l.finder.contractFinder(),i.get(this.controller+"?action=open&path="+encodeURIComponent(t),function(e){"error"!=l.jsend.parse(e)&&(o.loadCurrent(),l.modal.unload(),l.user.project(t),localStorage.removeItem("lastSearched"),amplify.publish("project.onOpen",t))})},list:function(){i("#modal-content form").die("submit"),l.modal.load(500,this.dialog+"?action=list")},loadSide:function(){i(".sb-projects-content").load(this.dialog+"?action=sidelist&trigger="+localStorage.getItem("codiad.editor.fileManagerTrigger")),this._sideExpanded=!0},projectsExpand:function(){this._sideExpanded=!0,i("#side-projects").css("height","100px"),i(".project-list-title").css("right",0),i(".sb-left-content").css("bottom","100px"),i("#projects-collapse").removeClass("icon-up-dir").addClass("icon-down-dir")},projectsCollapse:function(){this._sideExpanded=!1,i("#side-projects").css("height","33px"),i(".project-list-title").css("right",0),i(".sb-left-content").css("bottom","33px"),i("#projects-collapse").removeClass("icon-down-dir").addClass("icon-up-dir")},list:function(){i("#modal-content form").die("submit"),l.modal.load(500,this.dialog+"?action=list")},create:function(e){var r=this;create=!0,l.modal.load(500,this.dialog+"?action=create&close="+e),i("#modal-content form").live("submit",function(e){e.preventDefault();var t=i('#modal-content form input[name="project_name"]').val(),o=i('#modal-content form input[name="project_path"]').val(),n=i('#modal-content form input[name="git_repo"]').val(),a=i('#modal-content form input[name="git_branch"]').val();0==o.indexOf("/")&&(create=confirm('Do you really want to create project with absolute path "'+o+'"?')),create&&i.get(r.controller+"?action=create&project_name="+encodeURIComponent(t)+"&project_path="+encodeURIComponent(o)+"&git_repo="+n+"&git_branch="+a,function(e){createResponse=l.jsend.parse(e),"error"!=createResponse&&(r.open(createResponse.path),l.modal.unload(),r.loadSide(),amplify.publish("project.onCreate",{name:t,path:o,git_repo:n,git_branch:a}))})})},rename:function(e,t){var n=this;l.modal.load(500,this.dialog+"?action=rename&path="+encodeURIComponent(e)+"&name="+t),i("#modal-content form").live("submit",function(e){e.preventDefault();var t=i('#modal-content form input[name="project_path"]').val(),o=i('#modal-content form input[name="project_name"]').val();i.get(n.controller+"?action=rename&project_path="+encodeURIComponent(t)+"&project_name="+encodeURIComponent(o),function(e){renameResponse=l.jsend.parse(e),"error"!=renameResponse&&(l.message.success(i18n("Project renamed")),n.loadSide(),i('#file-manager a[data-type="root"]').html(o),l.modal.unload(),amplify.publish("project.onRename",{path:t,name:o}))})})},delete:function(r,e){var c=this;l.modal.load(500,this.dialog+"?action=delete&name="+encodeURIComponent(r)+"&path="+encodeURIComponent(e)),i("#modal-content form").live("submit",function(e){e.preventDefault();var t=i('#modal-content form input[name="project_path"]').val(),o=i('input:checkbox[name="delete"]:checked').val(),n=i('input:checkbox[name="follow"]:checked').val(),a="?action=delete";void 0!==o&&(a+=void 0!==n?"&follow=true&path="+encodeURIComponent(t):"&path="+encodeURIComponent(t)),i.get(l.filemanager.controller+a,function(e){i.get(c.controller+"?action=delete&project_path="+encodeURIComponent(t),function(e){deleteResponse=l.jsend.parse(e),"error"!=deleteResponse&&(l.message.success(i18n("Project Deleted")),c.list(),c.loadSide(),i("#active-files a").each(function(){var e=i(this).attr("data-path");0==e.indexOf(t)&&l.active.remove(e)}),amplify.publish("project.onDelete",{path:t,name:r}))})})})},isAbsPath:function(e){return 0==e.indexOf("/")},getCurrent:function(){var t=null;return i.ajax({url:this.controller+"?action=current",async:!1,success:function(e){t=l.jsend.parse(e)}}),t}}}(this,jQuery);